"use client"

import React, { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip"
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group"
import { Calendar } from "@/components/ui/calendar"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { Download, RefreshCw, ChevronDown, ChevronUp, ArrowUpDown, FileSpreadsheet, ArrowUp, ArrowDown, CheckCircle, Loader2, CalendarIcon, X } from "lucide-react"
import { ReportsFilterBar } from "@/components/reports-filter-bar"
import { ReportsHeader } from "@/components/navigator/reports-header"
import { ScheduledReports } from "@/components/scheduled-reports"
import { format } from "date-fns"
import { useEffect, useRef } from "react"

// Mock data for channels
const channelsData = [
  "All Channels",
  "Agoda", 
  "AgodaID",
  "AgodaIN", 
  "AgodaUS",
  "Booking_Member",
  "Booking.com",
  "BookingAE",
  "Expedia",
  "Hotels.com",
  "Priceline",
  "Travelocity"
]

// Mock data for hotels
const primaryHotelsData = [
  'All Primary Hotels', 'Marriott Executive Apartments Mayfair', 'Chaidee Mansion', 
  'Sukhumvit 12 Bangkok Hotel', 'Holiday Inn Bangkok Silom', 'Marriott Executive Apartments Sukhumvit Park',
  'Grand Palace Hotel', 'Bangkok Marriott Hotel Sukhumvit', 'The Peninsula Bangkok', 
  'Mandarin Oriental Bangkok', 'Shangri-La Hotel Bangkok'
]

const secondaryHotelsData = [
  'All Secondary Hotels', 'Anantara Siam Bangkok Hotel', 'The St. Regis Bangkok',
  'Four Seasons Hotel Bangkok', 'InterContinental Bangkok', 'Hilton Bangkok',
  'Hyatt Regency Bangkok', 'Novotel Bangkok Sukhumvit', 'Pullman Bangkok King Power',
  'Centara Grand at CentralWorld', 'Amari Watergate Bangkok'
]

// Mock data for reports
const reportsData = [
  {
    id: "18665450",
    rrds: 350,
    shopDate: "15 Aug'25",
    checkInDates: "15 Aug - 19 Aug'25",
    reportType: "Scheduled",
    reportDays: 5,
    los: 1,
    guests: 1,
    status: "Generated",
  },
  {
    id: "18662070",
    rrds: 350,
    shopDate: "14 Aug'25",
    checkInDates: "14 Aug - 18 Aug'25",
    reportType: "Scheduled",
    reportDays: 5,
    los: 1,
    guests: 1,
    status: "In Progress",
  },
  {
    id: "18658782",
    rrds: 350,
    shopDate: "13 Aug'25",
    checkInDates: "13 Aug - 17 Aug'25",
    reportType: "Scheduled",
    reportDays: 5,
    los: 1,
    guests: 1,
    status: "Generated",
  },
  {
    id: "18655240",
    rrds: 40,
    shopDate: "12 Aug'25",
    checkInDates: "12 Aug - 31 Aug'25",
    reportType: "OnDemand",
    reportDays: 20,
    los: 1,
    guests: 1,
    status: "Generated",
  },
]

function ReportsPage() {
  const [reportType, setReportType] = useState("All")
  const [dateRange, setDateRange] = useState<{ start: Date | undefined; end: Date | undefined }>({ start: undefined, end: undefined })
  
  // Sorting state
  const [sortConfig, setSortConfig] = useState<{ key: string | null; direction: 'asc' | 'desc' | null }>({ key: null, direction: null })
  
  // Expanded row state (only one row can be expanded at a time)
  const [expandedRow, setExpandedRow] = useState<string | null>(null)
  
  // Modal state
  const [isModalOpen, setIsModalOpen] = useState(false)
  
  // View state for switching between All Reports and Scheduled Reports
  const [currentView, setCurrentView] = useState<'all' | 'scheduled'>('all')
  
  // Form data state
  const [formData, setFormData] = useState({
    selectedChannels: ['All Channels'],
    compSet: 'primary',
    selectedPrimaryHotels: ['All Primary Hotels'],
    selectedSecondaryHotels: ['All Secondary Hotels'],
    guests: '1',
    los: '1',
    startDate: undefined as Date | undefined,
    endDate: undefined as Date | undefined,
    recipients: ['rahul.kumar@rategain.com'],
    newRecipient: ''
  })

  // Date validation state
  const [dateError, setDateError] = useState('')

  // Form validation state
  const [formErrors, setFormErrors] = useState({
    channels: '',
    guests: '',
    los: '',
    startDate: '',
    endDate: ''
  })

  // Snackbar state
  const [showSnackbar, setShowSnackbar] = useState(false)
  const [showSecondSnackbar, setShowSecondSnackbar] = useState(false)

  // State for dropdowns
  const [isChannelsOpen, setIsChannelsOpen] = useState(false)
  const [isPrimaryHotelsOpen, setIsPrimaryHotelsOpen] = useState(false)
  const [isSecondaryHotelsOpen, setIsSecondaryHotelsOpen] = useState(false)
  const [isGuestsOpen, setIsGuestsOpen] = useState(false)
  const [isLosOpen, setIsLosOpen] = useState(false)
  
  // State for calendar popovers
  const [isStartDateOpen, setIsStartDateOpen] = useState(false)
  const [isEndDateOpen, setIsEndDateOpen] = useState(false)
  const channelsRef = useRef<HTMLDivElement>(null)
  const primaryHotelsRef = useRef<HTMLDivElement>(null)
  const secondaryHotelsRef = useRef<HTMLDivElement>(null)
  const guestsRef = useRef<HTMLDivElement>(null)
  const losRef = useRef<HTMLDivElement>(null)

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (channelsRef.current && !channelsRef.current.contains(event.target as Node)) {
        setIsChannelsOpen(false)
      }
      if (primaryHotelsRef.current && !primaryHotelsRef.current.contains(event.target as Node)) {
        setIsPrimaryHotelsOpen(false)
      }
      if (secondaryHotelsRef.current && !secondaryHotelsRef.current.contains(event.target as Node)) {
        setIsSecondaryHotelsOpen(false)
      }
      if (guestsRef.current && !guestsRef.current.contains(event.target as Node)) {
        setIsGuestsOpen(false)
      }
      if (losRef.current && !losRef.current.contains(event.target as Node)) {
        setIsLosOpen(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [])
  

  // Handle filter changes
  const handleDateRangeChange = (startDate: Date | undefined, endDate: Date | undefined) => {
    setDateRange({ start: startDate, end: endDate })
    // Apply filtering logic here
    console.log('Date range changed:', { startDate, endDate })
  }

  const handleReportTypeChange = (newReportType: string) => {
    setReportType(newReportType)
    // Apply filtering logic here
    console.log('Report type changed:', newReportType)
  }

  const handleRefresh = () => {
    // Implement refresh logic
    console.log('Refreshing reports...')
    // You can add actual refresh logic here
  }

  const handleCreateOnDemand = () => {
    setIsModalOpen(true)
  }

  const handleScheduleSettings = () => {
    // Implement schedule settings logic
    console.log('Opening schedule settings...')
    // You can add actual schedule settings logic here
  }

  // Form handling functions
  const handleFormChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }))
  }

  const handleAddRecipient = () => {
    if (formData.newRecipient && !formData.recipients.includes(formData.newRecipient)) {
      setFormData(prev => ({
        ...prev,
        recipients: [...prev.recipients, prev.newRecipient],
        newRecipient: ''
      }))
    }
  }

  const handleRemoveRecipient = (email: string) => {
    setFormData(prev => ({
      ...prev,
      recipients: prev.recipients.filter(recipient => recipient !== email)
    }))
  }

  // Form validation function
  const validateForm = () => {
    const errors = {
      channels: '',
      guests: '',
      los: '',
      startDate: '',
      endDate: ''
    }

    // Validate channels
    if (!formData.selectedChannels || formData.selectedChannels.length === 0) {
      errors.channels = 'Please select at least one channel'
    }

    // Validate guests
    if (!formData.guests) {
      errors.guests = 'Please select number of guests'
    }

    // Validate LOS
    if (!formData.los) {
      errors.los = 'Please select length of stay'
    }

    // Validate start date
    if (!formData.startDate) {
      errors.startDate = 'Please select check-in start date'
    }

    // Validate end date
    if (!formData.endDate) {
      errors.endDate = 'Please select check-in end date'
    }

    setFormErrors(errors)
    
    // Return true if no errors
    return Object.values(errors).every(error => error === '')
  }

  const handleGenerate = () => {
    // Validate form before proceeding
    if (!validateForm()) {
      return // Don't proceed if validation fails
    }

    console.log('Generating report with data:', formData)
    setIsModalOpen(false)
    setShowSnackbar(true)
    // Reset form
    setFormData({
      selectedChannels: ['All Channels'],
      compSet: 'primary',
      selectedPrimaryHotels: ['All Primary Hotels'],
      selectedSecondaryHotels: ['All Secondary Hotels'],
      guests: '1',
      los: '1',
      startDate: undefined,
      endDate: undefined,
      recipients: ['rahul.kumar@rategain.com'],
      newRecipient: ''
    })
    setIsChannelsOpen(false)
    setIsPrimaryHotelsOpen(false)
    setIsSecondaryHotelsOpen(false)
    setIsGuestsOpen(false)
    setIsLosOpen(false)
    setIsStartDateOpen(false)
    setIsEndDateOpen(false)
    setDateError('')
    setFormErrors({
      channels: '',
      guests: '',
      los: '',
      startDate: '',
      endDate: ''
    })
  }

  const handleCancel = () => {
    setIsModalOpen(false)
    // Reset form
    setFormData({
      selectedChannels: ['All Channels'],
      compSet: 'primary',
      selectedPrimaryHotels: ['All Primary Hotels'],
      selectedSecondaryHotels: ['All Secondary Hotels'],
      guests: '1',
      los: '1',
      startDate: undefined,
      endDate: undefined,
      recipients: ['rahul.kumar@rategain.com'],
      newRecipient: ''
    })
    setIsChannelsOpen(false)
    setIsPrimaryHotelsOpen(false)
    setIsSecondaryHotelsOpen(false)
    setIsGuestsOpen(false)
    setIsLosOpen(false)
    setIsStartDateOpen(false)
    setIsEndDateOpen(false)
    setDateError('')
    setFormErrors({
      channels: '',
      guests: '',
      los: '',
      startDate: '',
      endDate: ''
    })
  }

  // Handle channel selection
  const handleChannelToggle = (channel: string) => {
    setFormData(prev => {
      let newChannels = [...prev.selectedChannels]
      
      if (channel === 'All Channels') {
        // If "All Channels" is selected, select all channels
        if (newChannels.includes('All Channels')) {
          // If already selected, deselect all
          newChannels = []
        } else {
          // Select all channels including "All Channels"
          newChannels = [...channelsData]
        }
      } else {
        // Handle individual channel selection
        if (newChannels.includes(channel)) {
          // Remove channel if already selected
          newChannels = newChannels.filter(c => c !== channel)
          // Also remove "All Channels" since not all are selected now
          newChannels = newChannels.filter(c => c !== 'All Channels')
        } else {
          // Add channel if not selected
          newChannels.push(channel)
          
          // Check if all individual channels are now selected
          const individualChannels = channelsData.filter(c => c !== 'All Channels')
          const selectedIndividualChannels = newChannels.filter(c => c !== 'All Channels')
          
          if (selectedIndividualChannels.length === individualChannels.length) {
            // If all individual channels are selected, also select "All Channels"
            if (!newChannels.includes('All Channels')) {
              newChannels.push('All Channels')
            }
          }
        }
        
        // If no channels selected, default to "All Channels"
        if (newChannels.length === 0) {
          newChannels = ['All Channels']
        }
      }
      
      return { ...prev, selectedChannels: newChannels }
    })
  }

  // Check if a channel should be checked
  const isChannelSelected = (channel: string) => {
    if (formData.selectedChannels.includes('All Channels')) {
      // If "All Channels" is selected, show all channels as selected
      return true
    }
    return formData.selectedChannels.includes(channel)
  }

  // Handle primary hotel selection
  const handlePrimaryHotelToggle = (hotel: string) => {
    setFormData(prev => {
      let newHotels = [...prev.selectedPrimaryHotels]
      
      if (hotel === 'All Primary Hotels') {
        // If "All Primary Hotels" is selected, select all hotels
        if (newHotels.includes('All Primary Hotels')) {
          // If already selected, deselect all
          newHotels = []
        } else {
          // Select all hotels including "All Primary Hotels"
          newHotels = [...primaryHotelsData]
        }
      } else {
        // Handle individual hotel selection
        if (newHotels.includes(hotel)) {
          // Remove hotel if already selected
          newHotels = newHotels.filter(h => h !== hotel)
          // Also remove "All Primary Hotels" since not all are selected now
          newHotels = newHotels.filter(h => h !== 'All Primary Hotels')
        } else {
          // Add hotel if not selected
          newHotels.push(hotel)
          
          // Check if all individual hotels are now selected
          const individualHotels = primaryHotelsData.filter(h => h !== 'All Primary Hotels')
          const selectedIndividualHotels = newHotels.filter(h => h !== 'All Primary Hotels')
          
          if (selectedIndividualHotels.length === individualHotels.length) {
            // If all individual hotels are selected, also select "All Primary Hotels"
            if (!newHotels.includes('All Primary Hotels')) {
              newHotels.push('All Primary Hotels')
            }
          }
        }
        
        // If no hotels selected, default to "All Primary Hotels"
        if (newHotels.length === 0) {
          newHotels = ['All Primary Hotels']
        }
      }
      
      return { ...prev, selectedPrimaryHotels: newHotels }
    })
  }

  // Handle secondary hotel selection
  const handleSecondaryHotelToggle = (hotel: string) => {
    setFormData(prev => {
      let newHotels = [...prev.selectedSecondaryHotels]
      
      if (hotel === 'All Secondary Hotels') {
        // If "All Secondary Hotels" is selected, select all hotels
        if (newHotels.includes('All Secondary Hotels')) {
          // If already selected, deselect all
          newHotels = []
        } else {
          // Select all hotels including "All Secondary Hotels"
          newHotels = [...secondaryHotelsData]
        }
      } else {
        // Handle individual hotel selection
        if (newHotels.includes(hotel)) {
          // Remove hotel if already selected
          newHotels = newHotels.filter(h => h !== hotel)
          // Also remove "All Secondary Hotels" since not all are selected now
          newHotels = newHotels.filter(h => h !== 'All Secondary Hotels')
        } else {
          // Add hotel if not selected
          newHotels.push(hotel)
          
          // Check if all individual hotels are now selected
          const individualHotels = secondaryHotelsData.filter(h => h !== 'All Secondary Hotels')
          const selectedIndividualHotels = newHotels.filter(h => h !== 'All Secondary Hotels')
          
          if (selectedIndividualHotels.length === individualHotels.length) {
            // If all individual hotels are selected, also select "All Secondary Hotels"
            if (!newHotels.includes('All Secondary Hotels')) {
              newHotels.push('All Secondary Hotels')
            }
          }
        }
        
        // If no hotels selected, default to "All Secondary Hotels"
        if (newHotels.length === 0) {
          newHotels = ['All Secondary Hotels']
        }
      }
      
      return { ...prev, selectedSecondaryHotels: newHotels }
    })
  }

  // Check if a primary hotel should be checked
  const isPrimaryHotelSelected = (hotel: string) => {
    if (formData.selectedPrimaryHotels.includes('All Primary Hotels')) {
      // If "All Primary Hotels" is selected, show all hotels as selected
      return true
    }
    return formData.selectedPrimaryHotels.includes(hotel)
  }

  // Check if a secondary hotel should be checked
  const isSecondaryHotelSelected = (hotel: string) => {
    if (formData.selectedSecondaryHotels.includes('All Secondary Hotels')) {
      // If "All Secondary Hotels" is selected, show all hotels as selected
      return true
    }
    return formData.selectedSecondaryHotels.includes(hotel)
  }

  // Snackbar functions
  const handleSnackbarOk = () => {
    setShowSnackbar(false)
    // Show second snackbar after 4 seconds
    setTimeout(() => {
      setShowSecondSnackbar(true)
    }, 4000)
  }

  const handleSecondSnackbarClose = () => {
    setShowSecondSnackbar(false)
  }

  // Date validation functions
  const handleStartDateSelect = (date: Date | undefined) => {
    setFormData(prev => ({ ...prev, startDate: date }))
    
    // Close the calendar popover
    setIsStartDateOpen(false)
    
    // Clear error when start date is selected
    if (dateError) {
      setDateError('')
    }
    
    // If end date exists and is before the new start date, clear end date
    if (date && formData.endDate && formData.endDate < date) {
      setFormData(prev => ({ ...prev, endDate: undefined }))
      setDateError('End date cannot be before start date. Please select a new end date.')
    }
  }

  const handleEndDateSelect = (date: Date | undefined) => {
    // Validate that end date is not before start date
    if (date && formData.startDate && date < formData.startDate) {
      setDateError('End date cannot be before start date')
      return
    }
    
    setFormData(prev => ({ ...prev, endDate: date }))
    setDateError('')
    
    // Close the calendar popover
    setIsEndDateOpen(false)
  }

  // Toggle row expansion (only one row can be expanded at a time)
  const toggleRowExpansion = (reportId: string) => {
    setExpandedRow(prev => {
      // If clicking the same row, collapse it
      if (prev === reportId) {
        return null
      }
      // Otherwise, expand the new row (this automatically collapses the previous one)
      return reportId
    })
  }


  // Sorting logic
  const handleSort = (key: string) => {
    let direction: 'asc' | 'desc' = 'asc'
    
    if (sortConfig.key === key && sortConfig.direction === 'asc') {
      direction = 'desc'
    } else if (sortConfig.key === key && sortConfig.direction === 'desc') {
      direction = null
    }
    
    setSortConfig({ key: direction ? key : null, direction })
  }

  const getSortIcon = (key: string) => {
    if (sortConfig.key !== key) {
      return null // Don't show icon for unsorted columns
    }
    
    if (sortConfig.direction === 'asc') {
      return <ArrowUp className="w-3 h-3 font-bold text-blue-600" strokeWidth={2.5} />
    } else if (sortConfig.direction === 'desc') {
      return <ArrowDown className="w-3 h-3 font-bold text-blue-600" strokeWidth={2.5} />
    }
    
    return <ArrowUpDown className="w-3 h-3 font-bold text-blue-600" strokeWidth={2.5} />
  }

  const getHoverIcon = (key: string) => {
    if (sortConfig.key === key) {
      return null // Don't show hover icon for currently sorted column
    }
    return <ArrowUpDown className="w-3 h-3 font-bold text-gray-500 dark:text-gray-400" strokeWidth={2.5} />
  }

  // Sort the data based on current sort configuration
  const sortedReportsData = [...reportsData].sort((a, b) => {
    if (!sortConfig.key || !sortConfig.direction) return 0

    const aValue = a[sortConfig.key as keyof typeof a]
    const bValue = b[sortConfig.key as keyof typeof b]

    if (aValue < bValue) {
      return sortConfig.direction === 'asc' ? -1 : 1
    }
    if (aValue > bValue) {
      return sortConfig.direction === 'asc' ? 1 : -1
    }
    return 0
  })

  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-950">
      {currentView === 'all' ? (
        <>
          {/* Enhanced Filter Bar with Sticky Positioning */}
          <div className="sticky top-0 z-40 bg-white/95 dark:bg-slate-950/95 backdrop-blur-md border-b border-border/50 shadow-sm transition-shadow duration-200 relative overflow-hidden">
            <ReportsFilterBar 
              onDateRangeChange={handleDateRangeChange}
              onReportTypeChange={handleReportTypeChange}
            />
          </div>

          {/* Professional Header Section */}
          <section className="w-full mt-4">
            <div className="w-full px-4 md:px-6 lg:px-8 xl:px-12 2xl:px-16">
              <div className="max-w-7xl xl:max-w-none mx-auto">
                <ReportsHeader 
                  handleRefresh={handleRefresh} 
                  handleCreateOnDemand={handleCreateOnDemand}
                  handleScheduleSettings={() => setCurrentView('scheduled')}
                />
              </div>
            </div>
          </section>

          {/* Main Content Area */}
          <div className="w-full px-4 md:px-6 lg:px-8 xl:px-12 2xl:px-16 pt-0 md:pt-0 lg:pt-0 xl:pt-2 pb-4 md:pb-6 lg:pb-8 xl:pb-10">
            <div className="max-w-7xl xl:max-w-none mx-auto space-y-4 md:space-y-6 lg:space-y-8">

              {/* Reports Table - Compact Design */}
              <Card className="shadow-lg relative overflow-hidden mb-6" style={{ marginBottom: '24px' }}>
                <CardHeader className="pb-2">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <CardTitle className="text-lg font-semibold">Reports: {sortedReportsData.length} Listed</CardTitle>
                    </div>
                  </div>
                </CardHeader>
                <CardContent className="px-6 pt-1 pb-6">
                  <div className="overflow-x-auto">
                    <div className="min-w-full">
                    {/* Table Header */}
                    <div className="border border-gray-200 dark:border-gray-700 rounded-t-lg" style={{ backgroundColor: 'rgb(243 244 246/var(--tw-bg-opacity,1))' }}>
                      <div className="grid grid-cols-12 gap-3 px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                        <div className="col-span-2 capitalize flex items-start">Report Id</div>
                        <div 
                          className="col-span-1 flex items-start gap-1 capitalize cursor-pointer group -ml-2"
                          onClick={() => handleSort('rrds')}
                        >
                          RRDs
                          <span className="opacity-0 group-hover:opacity-100 transition-opacity mt-0.5">
                            {getHoverIcon('rrds')}
                          </span>
                          <span className="opacity-100 mt-0.5">
                            {getSortIcon('rrds')}
                          </span>
                      </div>
                    <div 
                      className="col-span-1 flex items-start gap-1 capitalize cursor-pointer group"
                      onClick={() => handleSort('shopDate')}
                    >
                        Shop Date
                      <span className="opacity-0 group-hover:opacity-100 transition-opacity mt-0.5">
                        {getHoverIcon('shopDate')}
                      </span>
                      <span className="opacity-100 mt-0.5">
                        {getSortIcon('shopDate')}
                      </span>
                    </div>
                    <div 
                      className="col-span-2 flex items-start gap-1 capitalize cursor-pointer group ml-4"
                      onClick={() => handleSort('checkInDates')}
                    >
                      Check-In<br />Dates
                      <span className="opacity-0 group-hover:opacity-100 transition-opacity mt-0.5">
                        {getHoverIcon('checkInDates')}
                      </span>
                      <span className="opacity-100 mt-0.5">
                        {getSortIcon('checkInDates')}
                      </span>
                    </div>
                    <div 
                      className="col-span-1 flex items-start gap-1 capitalize cursor-pointer group"
                      onClick={() => handleSort('reportType')}
                    >
                      Report<br />Type
                      <span className="opacity-0 group-hover:opacity-100 transition-opacity mt-0.5">
                        {getHoverIcon('reportType')}
                      </span>
                      <span className="opacity-100 mt-0.5">
                        {getSortIcon('reportType')}
                      </span>
                    </div>
                    <div 
                      className="col-span-1 flex items-start gap-1 capitalize cursor-pointer group -ml-2"
                      onClick={() => handleSort('reportDays')}
                    >
                      Report<br />Days
                      <span className="opacity-0 group-hover:opacity-100 transition-opacity mt-0.5">
                        {getHoverIcon('reportDays')}
                      </span>
                      <span className="opacity-100 mt-0.5">
                        {getSortIcon('reportDays')}
                      </span>
                    </div>
                    <div className="col-span-1 capitalize flex items-start -ml-2 mr-4">LOS</div>
                    <div className="col-span-1 capitalize flex items-start -ml-4">Guests</div>
                    <div className="col-span-1 capitalize flex items-start -ml-4">Status</div>
                    <div className="col-span-1 capitalize flex items-start -ml-4">Action</div>
                  </div>
                </div>
                
                {/* Table Body */}
                <div className="bg-white dark:bg-gray-900 border-l border-r border-b border-gray-200 dark:border-gray-700 rounded-b-lg">
                  {sortedReportsData.map((report, index) => {
                    const isExpanded = expandedRow === report.id
                    const isNextRowExpanded = index < sortedReportsData.length - 1 && expandedRow === sortedReportsData[index + 1].id
                    
                    return (
                    <>
                    <div 
                      key={report.id} 
                      className={`grid grid-cols-12 gap-3 px-4 py-2 text-sm ${
                        isNextRowExpanded
                          ? 'border-b border-blue-200 dark:border-blue-500'
                          : isExpanded && index === reportsData.length - 1
                          ? 'border-b-0'
                          : 'border-b border-gray-100 dark:border-gray-800'
                      } ${
                        isExpanded
                          ? 'bg-blue-100 dark:bg-blue-800/30'
                          : index % 2 === 0 
                          ? 'bg-white dark:bg-gray-900' 
                          : 'bg-gray-50 dark:bg-gray-800/50'
                      } ${
                        isExpanded && index === reportsData.length - 1
                          ? 'rounded-b-none'
                          : index === reportsData.length - 1 ? 'rounded-b-lg' : ''
                      }`}
                    >
                      <div className="col-span-2 flex items-center gap-2">
                        <Tooltip>
                          <TooltipTrigger asChild>
                            <div 
                              className="flex items-center gap-2 cursor-pointer group"
                              onClick={() => toggleRowExpansion(report.id)}
                            >
                              <span className="text-blue-600 group-hover:text-blue-800 font-medium">
                                {report.id}
                              </span>
                              <div className="w-4 h-4 border border-blue-600 dark:border-blue-600 rounded-full flex items-center justify-center group-hover:border-blue-700 transition-colors">
                                {isExpanded ? (
                                  <ChevronUp className="w-2.5 h-2.5 text-blue-600 group-hover:text-blue-700" strokeWidth="2.5" />
                                ) : (
                                  <ChevronDown className="w-2.5 h-2.5 text-blue-600 group-hover:text-blue-700" strokeWidth="2.5" />
                                )}
                              </div>
                            </div>
                          </TooltipTrigger>
                          <TooltipContent className="bg-black text-white border-black text-xs px-2 py-1">
                            <p>{isExpanded ? "Hide Report Details" : "Show Report Details"}</p>
                          </TooltipContent>
                        </Tooltip>
                      </div>
                      <div className="col-span-1 font-medium flex items-center -ml-2">{report.rrds}</div>
                      <div className="col-span-1 flex items-center">{report.shopDate}</div>
                      <div className="col-span-2 flex items-center ml-4">{report.checkInDates}</div>
                      <div className="col-span-1 flex items-center">
                        <Tooltip>
                          <TooltipTrigger asChild>
                            <Badge
                              variant={report.reportType === "Scheduled" ? "secondary" : "outline"}
                              className={report.reportType === "OnDemand" ? "bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400 hover:bg-orange-100 hover:text-orange-800 dark:hover:bg-orange-900/20 dark:hover:text-orange-400" : ""}
                            >
                              {report.reportType === "Scheduled" ? "Sch." : "OD"}
                            </Badge>
                          </TooltipTrigger>
                          <TooltipContent className="bg-black text-white border-black text-xs px-2 py-1">
                            <p>{report.reportType === "Scheduled" ? "Scheduled Report" : "On Demand Report"}</p>
                          </TooltipContent>
                        </Tooltip>
                      </div>
                      <div className="col-span-1 flex items-center -ml-2">{report.reportDays}</div>
                      <div className="col-span-1 flex items-center -ml-2 mr-4">{report.los}</div>
                      <div className="col-span-1 flex items-center -ml-4">{report.guests}</div>
                      <div className="col-span-1 flex items-center -ml-4">
                        <Tooltip>
                          <TooltipTrigger asChild>
                            <div className="flex items-center justify-center">
                              {report.status === "Generated" ? (
                                <div className="relative">
                                  <div className="w-4 h-4 border border-green-600 rounded-full"></div>
                                  <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="w-3 h-3 text-green-600">
                                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3.5" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M20 6L9 17l-5-5"/>
                                      </svg>
                                    </div>
                                  </div>
                                </div>
                              ) : (
                                <Loader2 className="w-4 h-4 text-orange-500 animate-spin" />
                              )}
                      </div>
                          </TooltipTrigger>
                          <TooltipContent className={`text-white text-xs px-2 py-1 ${
                            report.status === "Generated" 
                              ? "bg-green-600 border-green-600" 
                              : "bg-orange-500 border-orange-500"
                          }`}>
                            <p>{report.status === "Generated" ? "Report Generated" : "Report In Progress"}</p>
                          </TooltipContent>
                        </Tooltip>
                      </div>
                      <div className="col-span-1 flex items-center -ml-4">
                        <div className="flex items-center gap-2">
                          <Tooltip>
                            <TooltipTrigger asChild>
                              <Button 
                                variant="ghost" 
                                size="icon" 
                                className={`h-8 w-8 ${report.status !== "Generated" ? "opacity-50 cursor-not-allowed" : ""}`}
                                disabled={report.status !== "Generated"}
                              >
                            <Download className="w-4 h-4" />
                          </Button>
                            </TooltipTrigger>
                            <TooltipContent className="bg-black text-white border-black text-xs px-2 py-1">
                              <p>Download Detailed View (Macros)</p>
                            </TooltipContent>
                          </Tooltip>
                          <Tooltip>
                            <TooltipTrigger asChild>
                              <Button 
                                variant="ghost" 
                                size="icon" 
                                className={`h-8 w-8 ${report.status !== "Generated" ? "opacity-50 cursor-not-allowed" : ""}`}
                                disabled={report.status !== "Generated"}
                              >
                                <FileSpreadsheet className="w-4 h-4" />
                          </Button>
                            </TooltipTrigger>
                            <TooltipContent className="bg-black text-white border-black text-xs px-2 py-1">
                              <p>Download Raw Data</p>
                            </TooltipContent>
                          </Tooltip>
                        </div>
                      </div>
                    </div>
                    
                    {/* Expanded Content Row */}
                    {isExpanded && (
                      <div className={`grid grid-cols-12 gap-3 px-4 py-4 text-sm border-t border-blue-200 dark:border-blue-500 ${
                        index === reportsData.length - 1
                          ? 'rounded-b-lg'
                          : 'border-b border-blue-200 dark:border-blue-500'
                      } ${
                        index % 2 === 0
                          ? 'bg-blue-50 dark:bg-blue-900/20'
                          : 'bg-blue-50 dark:bg-blue-900/20'
                      }`}>
                        <div className="col-span-12">
                          <div className="grid grid-cols-12 gap-8">
                            {/* Schedule Name */}
                            <div className="col-span-3" style={{ marginLeft: '60px' }}>
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Schedule name</h4>
                              <p className="text-black dark:text-black font-semibold">Sample Schedule Name</p>
                            </div>
                            
                            {/* Channels */}
                            <div className="col-span-2">
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Channels (25)</h4>
                              <div className="text-black dark:text-black">
                                <div className="max-h-40 overflow-y-auto space-y-1">
                                  <ul className="space-y-1">
                                    {[
                                      "Agoda", "Booking.com", "Expedia", "Hotels.com", "TripAdvisor",
                                      "Priceline", "Orbitz", "Travelocity", "Kayak", "Trivago",
                                      "Hotwire", "Lastminute.com", "Amoma", "HotelsCombined", "RoomGuru",
                                      "HotelTonight", "Airbnb", "VRBO", "HomeAway", "BookingBuddy",
                                      "CheapTickets", "Travelocity", "Priceline Express", "Hotwire Express", "Lastminute"
                                    ].map((channel, idx) => (
                                      <li key={idx} className="flex items-start">
                                        <span className="w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 mt-1.5 flex-shrink-0"></span>
                                        <span className="text-sm leading-tight">{channel}</span>
                                      </li>
                                    ))}
                                  </ul>
                                </div>
                              </div>
                            </div>
                            
                            {/* Properties */}
                            <div className="col-span-3">
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Property (30)</h4>
                              <div className="text-black dark:text-black">
                                <div className="max-h-40 overflow-y-auto space-y-1">
                                  <ul className="space-y-1">
                                    {[
                                      "Marriott Executive Apartments Mayfair", "Chaidee Mansion", "Sukhumvit 12 Bangkok Hotel",
                                      "Holiday Inn Bangkok Silom", "Marriott Executive Apartments Sukhumvit Park", "Grand Palace Hotel",
                                      "Bangkok Marriott Hotel Sukhumvit", "The Peninsula Bangkok", "Mandarin Oriental Bangkok",
                                      "Shangri-La Hotel Bangkok", "Anantara Siam Bangkok Hotel", "The St. Regis Bangkok",
                                      "Four Seasons Hotel Bangkok", "InterContinental Bangkok", "Hilton Bangkok",
                                      "Hyatt Regency Bangkok", "Novotel Bangkok Sukhumvit", "Pullman Bangkok King Power",
                                      "Centara Grand at CentralWorld", "Amari Watergate Bangkok", "Royal Orchid Sheraton",
                                      "Millennium Hilton Bangkok", "Sofitel Bangkok Sukhumvit", "JW Marriott Bangkok",
                                      "The Westin Grande Sukhumvit", "Le Meridien Bangkok", "Renaissance Bangkok Ratchaprasong",
                                      "Courtyard by Marriott Bangkok", "Holiday Inn Express Bangkok Sathorn", "Ibis Bangkok Sathorn"
                                    ].map((property, idx) => (
                                      <li key={idx} className="flex items-start">
                                        <span className="w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 mt-1.5 flex-shrink-0"></span>
                                        <span className="text-sm leading-tight">{property}</span>
                                      </li>
                                    ))}
                                  </ul>
                                </div>
                              </div>
                            </div>
                            
                            {/* Currency */}
                            <div className="col-span-1">
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Currency</h4>
                              <p className="text-black dark:text-black">USD</p>
                            </div>
                            
                            {/* Data Sufficiency */}
                            <div className="col-span-1">
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Data Sufficiency</h4>
                              <p className="text-black dark:text-black">100%</p>
                            </div>
                            
                            {/* Generated By */}
                            <div className="col-span-1">
                              <h4 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">Generated by</h4>
                              <p className="text-black dark:text-black">Batch</p>
                            </div>
                            
                            {/* Additional Space */}
                            <div className="col-span-1"></div>
                          </div>
                        </div>
                      </div>
                    )}
                    </>
                    )
                  })}
                </div>
              </div>
            </div>
          </CardContent>
          </Card>

        </div>
      </div>
    </div>

    {/* On-Demand Report Modal */}
    <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>
      <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="text-xl font-semibold text-black">Generate On Demand Report</DialogTitle>
        </DialogHeader>
        
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">
          {/* Configure Section */}
          <div className="space-y-8">
            {/* Channels */}
            <div>
              <Label className="block text-xs font-medium text-gray-700 mb-1">
                Channels<span className="text-red-500 ml-1">*</span>
              </Label>
              <div className="relative" ref={channelsRef}>
                <button
                  type="button"
                  onClick={() => setIsChannelsOpen(!isChannelsOpen)}
                  className="w-full flex items-center justify-between px-3 py-2 text-sm border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none"
                >
                  <span className="truncate">
                    {formData.selectedChannels.includes('All Channels')
                      ? "All Channels"
                      : formData.selectedChannels.length === 1 
                        ? formData.selectedChannels[0]
                        : `${formData.selectedChannels.length} channels selected`
                    }
                  </span>
                  <ChevronDown className={`w-4 h-4 text-gray-400 transition-transform ${isChannelsOpen ? 'rotate-180' : ''}`} />
                </button>
                
                {isChannelsOpen && (
                  <div className="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                    {channelsData.map((channel) => (
                      <label
                        key={channel}
                        className="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer"
                      >
                        <input
                          type="checkbox"
                          checked={isChannelSelected(channel)}
                          onChange={() => handleChannelToggle(channel)}
                          className="w-4 h-4 mr-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                        />
                         <span className="text-sm text-gray-900 truncate" title={channel}>
                               {channel.length > 32 ? `${channel.substring(0, 32)}...` : channel}
                             </span>
                      </label>
                    ))}
                  </div>
                )}
              </div>
              {formErrors.channels && (
                <p className="text-red-500 text-xs mt-1">{formErrors.channels}</p>
              )}
            </div>

            {/* CompSet */}
            <div>
              <Label className="block text-xs font-medium text-gray-700 mb-2">CompSet</Label>
              <RadioGroup
                value={formData.compSet}
                onValueChange={(value) => handleFormChange('compSet', value)}
                className="flex space-x-6"
              >
                <div className="flex items-center space-x-2 relative" ref={primaryHotelsRef}>
                  <RadioGroupItem value="primary" id="primary" />
                  <Label 
                    htmlFor="primary" 
                    className="flex items-center space-x-2 text-sm text-gray-700 cursor-pointer"
                    onClick={() => setIsPrimaryHotelsOpen(!isPrimaryHotelsOpen)}
                  >
                    <span>Primary (10)</span>
                    <ChevronDown className="w-4 h-4 text-gray-400" />
                  </Label>
                  
                  {/* Primary Hotels Dropdown */}
                  {isPrimaryHotelsOpen && (
                    <div className="absolute z-50 top-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-y-auto min-w-80">
                      {primaryHotelsData.map((hotel) => (
                        <label
                          key={hotel}
                          className="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer"
                        >
                          <input
                            type="checkbox"
                            checked={isPrimaryHotelSelected(hotel)}
                            onChange={() => handlePrimaryHotelToggle(hotel)}
                            className="w-4 h-4 mr-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                          />
                          <span className="text-sm text-gray-900 truncate" title={hotel}>
                             {hotel.length > 32 ? `${hotel.substring(0, 32)}...` : hotel}
                           </span>
                        </label>
                      ))}
                    </div>
                  )}
                </div>
                <div className="flex items-center space-x-2 relative" ref={secondaryHotelsRef}>
                  <RadioGroupItem value="secondary" id="secondary" />
                  <Label 
                    htmlFor="secondary" 
                    className="flex items-center space-x-2 text-sm text-gray-700 cursor-pointer"
                    onClick={() => setIsSecondaryHotelsOpen(!isSecondaryHotelsOpen)}
                  >
                    <span>Secondary</span>
                    <ChevronDown className="w-4 h-4 text-gray-400" />
                  </Label>
                  
                  {/* Secondary Hotels Dropdown */}
                  {isSecondaryHotelsOpen && (
                    <div className="absolute z-50 top-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-y-auto min-w-80">
                      {secondaryHotelsData.map((hotel) => (
                        <label
                          key={hotel}
                          className="flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer"
                        >
                          <input
                            type="checkbox"
                            checked={isSecondaryHotelSelected(hotel)}
                            onChange={() => handleSecondaryHotelToggle(hotel)}
                            className="w-4 h-4 mr-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                          />
                          <span className="text-sm text-gray-900 truncate" title={hotel}>
                             {hotel.length > 32 ? `${hotel.substring(0, 32)}...` : hotel}
                           </span>
                        </label>
                      ))}
                    </div>
                  )}
                </div>
              </RadioGroup>
            </div>

            {/* Guests and LOS */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {/* Guests */}
              <div>
                <Label className="block text-xs font-medium text-gray-700 mb-1">
                  Guests<span className="text-red-500 ml-1">*</span>
                </Label>
                <div className="relative" ref={guestsRef}>
                  <button
                    type="button"
                    onClick={() => setIsGuestsOpen(!isGuestsOpen)}
                    className="w-full flex items-center justify-between px-3 py-2 text-sm border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none"
                  >
                    <span>{formData.guests}</span>
                    <ChevronDown className={`w-4 h-4 text-gray-400 transition-transform ${isGuestsOpen ? 'rotate-180' : ''}`} />
                  </button>
                  
                  {isGuestsOpen && (
                    <div className="absolute z-50 w-full bottom-full mb-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                      {Array.from({ length: 10 }, (_, i) => i + 1).map((number) => (
                        <button
                          key={number}
                          type="button"
                          onClick={() => {
                            handleFormChange('guests', number.toString())
                            setIsGuestsOpen(false)
                          }}
                          className="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:outline-none focus:bg-gray-50"
                        >
                          {number}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
                {formErrors.guests && (
                  <p className="text-red-500 text-xs mt-1">{formErrors.guests}</p>
                )}
              </div>

              {/* LOS */}
              <div>
                <Label className="block text-xs font-medium text-gray-700 mb-1">
                  LOS<span className="text-red-500 ml-1">*</span>
                </Label>
                <div className="relative" ref={losRef}>
                  <button
                    type="button"
                    onClick={() => setIsLosOpen(!isLosOpen)}
                    className="w-full flex items-center justify-between px-3 py-2 text-sm border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none"
                  >
                    <span>{formData.los}</span>
                    <ChevronDown className={`w-4 h-4 text-gray-400 transition-transform ${isLosOpen ? 'rotate-180' : ''}`} />
                  </button>
                  
                  {isLosOpen && (
                    <div className="absolute z-50 w-full bottom-full mb-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                      {Array.from({ length: 10 }, (_, i) => i + 1).map((number) => (
                        <button
                          key={number}
                          type="button"
                          onClick={() => {
                            handleFormChange('los', number.toString())
                            setIsLosOpen(false)
                          }}
                          className="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:outline-none focus:bg-gray-50"
                        >
                          {number}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
                {formErrors.los && (
                  <p className="text-red-500 text-xs mt-1">{formErrors.los}</p>
                )}
              </div>
            </div>
          </div>

          {/* Check-In Dates Section */}
          <div className="space-y-8">
            {/* Start Date and End Date in same row */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {/* Start Date */}
              <div>
                <Label className="block text-xs font-medium text-gray-700 mb-1">
                  Check-in Start Date<span className="text-red-500 ml-1">*</span>
                </Label>
                <Popover open={isStartDateOpen} onOpenChange={setIsStartDateOpen}>
                  <PopoverTrigger asChild>
                    <Button
                      variant="outline"
                      className="w-full justify-start text-left font-normal border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none"
                    >
                      <CalendarIcon className="mr-2 h-4 w-4" />
                      {formData.startDate ? format(formData.startDate, "dd MMM ''yy") : "Select start date"}
                    </Button>
                  </PopoverTrigger>
                  <PopoverContent className="w-auto p-0" align="start">
                    <Calendar
                      mode="single"
                      selected={formData.startDate}
                      onSelect={handleStartDateSelect}
                      numberOfMonths={1}
                      initialFocus
                      disabled={(date) => date < new Date(new Date().setHours(0, 0, 0, 0))}
                      fromDate={new Date()}
                    />
                  </PopoverContent>
                </Popover>
                {formErrors.startDate && (
                  <p className="text-red-500 text-xs mt-1">{formErrors.startDate}</p>
                )}
              </div>

              {/* End Date */}
              <div>
                <Label className="block text-xs font-medium text-gray-700 mb-1">
                  Check-in End Date<span className="text-red-500 ml-1">*</span>
                </Label>
                <Popover open={isEndDateOpen} onOpenChange={setIsEndDateOpen}>
                  <PopoverTrigger asChild>
                    <Button
                      variant="outline"
                      className="w-full justify-start text-left font-normal border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none"
                    >
                      <CalendarIcon className="mr-2 h-4 w-4" />
                      {formData.endDate ? format(formData.endDate, "dd MMM ''yy") : "Select end date"}
                    </Button>
                  </PopoverTrigger>
                  <PopoverContent className="w-auto p-0" align="start">
                    <Calendar
                      mode="single"
                      selected={formData.endDate}
                      onSelect={handleEndDateSelect}
                      numberOfMonths={1}
                      initialFocus
                      disabled={(date) => {
                        const today = new Date(new Date().setHours(0, 0, 0, 0))
                        const isBeforeToday = date < today
                        const isBeforeStartDate = formData.startDate && date < formData.startDate
                        return isBeforeToday || isBeforeStartDate
                      }}
                      fromDate={formData.startDate || new Date()}
                    />
                    {dateError && (
                      <div className="p-3 text-sm text-red-600 bg-red-50 border-t border-red-200">
                        {dateError}
                      </div>
                    )}
                  </PopoverContent>
                </Popover>
                {formErrors.endDate && (
                  <p className="text-red-500 text-xs mt-1">{formErrors.endDate}</p>
                )}
              </div>
            </div>

            {/* Recipients */}
            <div>
              <Label className="block text-xs font-medium text-gray-700 mb-2">Recipients</Label>
              <div className="space-y-2">
                {/* Existing Recipients */}
                {formData.recipients.map((email, index) => (
                  <div key={index} className="flex items-center justify-between bg-gray-50 rounded-md px-3 py-2 border border-gray-200">
                    <span className="text-sm text-gray-900 truncate">{email}</span>
                    <button
                      onClick={() => handleRemoveRecipient(email)}
                      className="flex-shrink-0 w-5 h-5 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors"
                    >
                      <X className="w-3 h-3 text-gray-500" />
                    </button>
                  </div>
                ))}
                
                {/* Add New Recipient */}
                <div>
                  <Input
                    placeholder="Enter email address"
                    value={formData.newRecipient}
                    onChange={(e) => handleFormChange('newRecipient', e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleAddRecipient()}
                    className="w-full"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
          <Button
            variant="outline"
            onClick={handleCancel}
            className="h-9 px-4 text-sm font-medium text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-colors"
          >
            Cancel
          </Button>
          <Button
            onClick={handleGenerate}
            className="h-9 px-4 text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors"
          >
            Generate
          </Button>
        </div>
      </DialogContent>
    </Dialog>

    {/* First Snackbar */}
    {showSnackbar && (
      <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50">
        <div className="bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-4 min-w-96">
          <div className="flex items-center gap-3">
            <div className="w-6 h-6 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
              </svg>
            </div>
            <span className="text-sm font-medium">
              Preparing your report... please wait. Processing large data may take some time.
            </span>
          </div>
          <Button
            onClick={handleSnackbarOk}
            variant="outline"
            size="sm"
            className="bg-white text-blue-600 border-white hover:bg-gray-100 px-4 py-1 h-8 text-sm font-medium"
          >
            OK
          </Button>
        </div>
      </div>
    )}

    {/* Second Snackbar */}
    {showSecondSnackbar && (
      <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50">
        <div className="bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-4 min-w-[800px]">
          <div className="flex items-center gap-3">
            <div className="w-6 h-6 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
              </svg>
            </div>
            <span className="text-sm font-medium whitespace-nowrap">
              Your 'On-Demand' report is available now, click here to '<span className="underline decoration-white cursor-pointer hover:no-underline">Download</span>' or check from '<span className="underline cursor-pointer">Reports</span>' page.
            </span>
          </div>
          <Button
            onClick={handleSecondSnackbarClose}
            variant="outline"
            size="sm"
            className="bg-white text-green-600 border-white hover:bg-gray-100 px-4 py-1 h-8 text-sm font-medium ml-auto"
          >
            DONE
          </Button>
        </div>
      </div>
    )}
        </>
      ) : (
        /* Scheduled Reports View */
        <section className="w-full mt-4">
          <div className="w-full px-4 md:px-6 lg:px-8 xl:px-12 2xl:px-16">
            <div className="max-w-7xl xl:max-w-none mx-auto">
              <ScheduledReports onBackToAllReports={() => setCurrentView('all')} />
            </div>
          </div>
        </section>
      )}
    </div>
  )
}

export default function ReportsPageWrapper() {
  return (
    <TooltipProvider>
      <ReportsPage />
    </TooltipProvider>
  )
}
